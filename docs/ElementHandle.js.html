<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>ElementHandle.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BoundIpc.html">BoundIpc</a><ul class='methods'><li data-type='method'><a href="BoundIpc.html#off">off</a></li><li data-type='method'><a href="BoundIpc.html#on">on</a></li><li data-type='method'><a href="BoundIpc.html#once">once</a></li><li data-type='method'><a href="BoundIpc.html#send">send</a></li><li data-type='method'><a href="BoundIpc.html#sendOn">sendOn</a></li></ul></li><li><a href="Browser.html">Browser</a><ul class='methods'><li data-type='method'><a href="Browser.html#bringToFront">bringToFront</a></li><li data-type='method'><a href="Browser.html#build">build</a></li><li data-type='method'><a href="Browser.html#close">close</a></li><li data-type='method'><a href="Browser.html#frontPage">frontPage</a></li><li data-type='method'><a href="Browser.html#getBoundingClientRect">getBoundingClientRect</a></li><li data-type='method'><a href="Browser.html#getPageById">getPageById</a></li><li data-type='method'><a href="Browser.html#init">init</a></li><li data-type='method'><a href="Browser.html#newPage">newPage</a></li><li data-type='method'><a href="Browser.html#pages">pages</a></li></ul></li><li></li><li><a href="BrowserManager.html">BrowserManager</a><ul class='methods'><li data-type='method'><a href="BrowserManager.html#frontBrowser">frontBrowser</a></li><li data-type='method'><a href="BrowserManager.html#get">get</a></li><li data-type='method'><a href="BrowserManager.html#launch">launch</a></li></ul></li><li></li><li><a href="ElementHandle.html">ElementHandle</a><ul class='methods'><li data-type='method'><a href="ElementHandle.html#$">$</a></li><li data-type='method'><a href="ElementHandle.html#$$">$$</a></li><li data-type='method'><a href="ElementHandle.html#$$eval">$$eval</a></li><li data-type='method'><a href="ElementHandle.html#$eval">$eval</a></li><li data-type='method'><a href="ElementHandle.html#$x">$x</a></li><li data-type='method'><a href="ElementHandle.html#asElement">asElement</a></li><li data-type='method'><a href="ElementHandle.html#blur">blur</a></li><li data-type='method'><a href="ElementHandle.html#boxModel">boxModel</a></li><li data-type='method'><a href="ElementHandle.html#check">check</a></li><li data-type='method'><a href="ElementHandle.html#click">click</a></li><li data-type='method'><a href="ElementHandle.html#contentFrame">contentFrame</a></li><li data-type='method'><a href="ElementHandle.html#dispose">dispose</a></li><li data-type='method'><a href="ElementHandle.html#executionContext">executionContext</a></li><li data-type='method'><a href="ElementHandle.html#focus">focus</a></li><li data-type='method'><a href="ElementHandle.html#getAttribute">getAttribute</a></li><li data-type='method'><a href="ElementHandle.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="ElementHandle.html#getBoundingClientRect">getBoundingClientRect</a></li><li data-type='method'><a href="ElementHandle.html#getProperties">getProperties</a></li><li data-type='method'><a href="ElementHandle.html#getProperty">getProperty</a></li><li data-type='method'><a href="ElementHandle.html#hover">hover</a></li><li data-type='method'><a href="ElementHandle.html#isIntersectingViewport">isIntersectingViewport</a></li><li data-type='method'><a href="ElementHandle.html#jsonValue">jsonValue</a></li><li data-type='method'><a href="ElementHandle.html#press">press</a></li><li data-type='method'><a href="ElementHandle.html#screenshot">screenshot</a></li><li data-type='method'><a href="ElementHandle.html#tap">tap</a></li><li data-type='method'><a href="ElementHandle.html#toString">toString</a></li><li data-type='method'><a href="ElementHandle.html#type">type</a></li><li data-type='method'><a href="ElementHandle.html#uncheck">uncheck</a></li><li data-type='method'><a href="ElementHandle.html#uploadFile">uploadFile</a></li></ul></li><li></li><li><a href="EventEmitter.html">EventEmitter</a><ul class='methods'><li data-type='method'><a href="EventEmitter.html#.noConflict">noConflict</a></li></ul></li><li><a href="Frame.html">Frame</a><ul class='methods'><li data-type='method'><a href="Frame.html#$">$</a></li><li data-type='method'><a href="Frame.html#$$">$$</a></li><li data-type='method'><a href="Frame.html#$$eval">$$eval</a></li><li data-type='method'><a href="Frame.html#$eval">$eval</a></li><li data-type='method'><a href="Frame.html#$x">$x</a></li><li data-type='method'><a href="Frame.html#addScriptTag">addScriptTag</a></li><li data-type='method'><a href="Frame.html#addStyleTag">addStyleTag</a></li><li data-type='method'><a href="Frame.html#blur">blur</a></li><li data-type='method'><a href="Frame.html#childFrames">childFrames</a></li><li data-type='method'><a href="Frame.html#click">click</a></li><li data-type='method'><a href="Frame.html#content">content</a></li><li data-type='method'><a href="Frame.html#evaluate">evaluate</a></li><li data-type='method'><a href="Frame.html#focus">focus</a></li><li data-type='method'><a href="Frame.html#goto">goto</a></li><li data-type='method'><a href="Frame.html#hover">hover</a></li><li data-type='method'><a href="Frame.html#isDetached">isDetached</a></li><li data-type='method'><a href="Frame.html#localStorageGet">localStorageGet</a></li><li data-type='method'><a href="Frame.html#localStorageKeys">localStorageKeys</a></li><li data-type='method'><a href="Frame.html#localStorageRemove">localStorageRemove</a></li><li data-type='method'><a href="Frame.html#localStorageSet">localStorageSet</a></li><li data-type='method'><a href="Frame.html#name">name</a></li><li data-type='method'><a href="Frame.html#page">page</a></li><li data-type='method'><a href="Frame.html#parentFrame">parentFrame</a></li><li data-type='method'><a href="Frame.html#select">select</a></li><li data-type='method'><a href="Frame.html#setContent">setContent</a></li><li data-type='method'><a href="Frame.html#tap">tap</a></li><li data-type='method'><a href="Frame.html#title">title</a></li><li data-type='method'><a href="Frame.html#type">type</a></li><li data-type='method'><a href="Frame.html#url">url</a></li><li data-type='method'><a href="Frame.html#waitFor">waitFor</a></li><li data-type='method'><a href="Frame.html#waitForFunction">waitForFunction</a></li><li data-type='method'><a href="Frame.html#waitForNavigation">waitForNavigation</a></li><li data-type='method'><a href="Frame.html#waitForSelector">waitForSelector</a></li><li data-type='method'><a href="Frame.html#waitForXPath">waitForXPath</a></li></ul></li><li></li><li><a href="Ipc.html">Ipc</a><ul class='methods'><li data-type='method'><a href="Ipc.html#off">off</a></li><li data-type='method'><a href="Ipc.html#on">on</a></li><li data-type='method'><a href="Ipc.html#once">once</a></li><li data-type='method'><a href="Ipc.html#send">send</a></li><li data-type='method'><a href="Ipc.html#sendOn">sendOn</a></li></ul></li><li></li><li><a href="Page.html">Page</a><ul class='methods'><li data-type='method'><a href="Page.html#$">$</a></li><li data-type='method'><a href="Page.html#$$">$$</a></li><li data-type='method'><a href="Page.html#$$eval">$$eval</a></li><li data-type='method'><a href="Page.html#$eval">$eval</a></li><li data-type='method'><a href="Page.html#$x">$x</a></li><li data-type='method'><a href="Page.html#addScriptTag">addScriptTag</a></li><li data-type='method'><a href="Page.html#addStyleTag">addStyleTag</a></li><li data-type='method'><a href="Page.html#bringToFront">bringToFront</a></li><li data-type='method'><a href="Page.html#browser">browser</a></li><li data-type='method'><a href="Page.html#build">build</a></li><li data-type='method'><a href="Page.html#canGoBack">canGoBack</a></li><li data-type='method'><a href="Page.html#canGoForward">canGoForward</a></li><li data-type='method'><a href="Page.html#click">click</a></li><li data-type='method'><a href="Page.html#close">close</a></li><li data-type='method'><a href="Page.html#content">content</a></li><li data-type='method'><a href="Page.html#cookies">cookies</a></li><li data-type='method'><a href="Page.html#deleteCookies">deleteCookies</a></li><li data-type='method'><a href="Page.html#evaluate">evaluate</a></li><li data-type='method'><a href="Page.html#evaluateHandle">evaluateHandle</a></li><li data-type='method'><a href="Page.html#find">find</a></li><li data-type='method'><a href="Page.html#focus">focus</a></li><li data-type='method'><a href="Page.html#frames">frames</a></li><li data-type='method'><a href="Page.html#goBack">goBack</a></li><li data-type='method'><a href="Page.html#goForward">goForward</a></li><li data-type='method'><a href="Page.html#goto">goto</a></li><li data-type='method'><a href="Page.html#hover">hover</a></li><li data-type='method'><a href="Page.html#init">init</a></li><li data-type='method'><a href="Page.html#isClosed">isClosed</a></li><li data-type='method'><a href="Page.html#isLoading">isLoading</a></li><li data-type='method'><a href="Page.html#isLoadingMainFrame">isLoadingMainFrame</a></li><li data-type='method'><a href="Page.html#localStorageGet">localStorageGet</a></li><li data-type='method'><a href="Page.html#localStorageKeys">localStorageKeys</a></li><li data-type='method'><a href="Page.html#localStorageRemove">localStorageRemove</a></li><li data-type='method'><a href="Page.html#localStorageSet">localStorageSet</a></li><li data-type='method'><a href="Page.html#mainFrame">mainFrame</a></li><li data-type='method'><a href="Page.html#queryObjects">queryObjects</a></li><li data-type='method'><a href="Page.html#reload">reload</a></li><li data-type='method'><a href="Page.html#screenshot">screenshot</a></li><li data-type='method'><a href="Page.html#select">select</a></li><li data-type='method'><a href="Page.html#setContent">setContent</a></li><li data-type='method'><a href="Page.html#setCookie">setCookie</a></li><li data-type='method'><a href="Page.html#tap">tap</a></li><li data-type='method'><a href="Page.html#title">title</a></li><li data-type='method'><a href="Page.html#type">type</a></li><li data-type='method'><a href="Page.html#url">url</a></li><li data-type='method'><a href="Page.html#waitFor">waitFor</a></li><li data-type='method'><a href="Page.html#waitForFunction">waitForFunction</a></li><li data-type='method'><a href="Page.html#waitForNavigation">waitForNavigation</a></li><li data-type='method'><a href="Page.html#waitForRequest">waitForRequest</a></li><li data-type='method'><a href="Page.html#waitForResponse">waitForResponse</a></li><li data-type='method'><a href="Page.html#waitForSelector">waitForSelector</a></li><li data-type='method'><a href="Page.html#waitForSrcScript">waitForSrcScript</a></li><li data-type='method'><a href="Page.html#waitForXPath">waitForXPath</a></li></ul></li><li></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">ElementHandle.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file ElementHandle类
 */

import EventEmitter from "./EventEmitter.js"
import USKeyboardLayout from "./USKeyboardLayout.js"
import {uniqueId} from "./util.js"

/**
 * @class ElementHandle frame的dom操作句柄
 * @extends EventEmitter
 *
 * @property {Frame} frame 所属frame实例
 * @property {string} selector 选择器
 * @property {string} baseSelector 基础选择器，先查找baseSelector，再在baseSelector的基础上查找当前节点
 *
 */
export default class ElementHandle extends EventEmitter {
  /**
   * @constructor ElementHandle
   *
   * @param {Frame} frame 所属frame实例
   * @param {string} selector 选择器
   * @param {string} baseSelector 基础选择器，先查找baseSelector，再在baseSelector的基础上查找当前节点
   *
   */
  constructor(frame, selector, baseSelector) {
    super()

    this.id = uniqueId("ElementHandle_")
    this.ipc = frame.ipc
    this.frame = frame
    this.selector = selector
    this.baseSelector = baseSelector
  }
  _joinSelfSelector() {
    var baseSelector = this.baseSelector.slice(0)
    baseSelector.push(this.selector)
    return baseSelector
  }
  _joinSelector(selector, baseSelector) {
    baseSelector = baseSelector.slice(0)
    baseSelector.push(selector)
    return baseSelector
  }
  /**
   * 基于当前节点，查询新的单个节点, 对应elm.querySelector(selector)
   * @param {string} selector
   *
   * @return {ElementHandle}
   */
  $(selector) {
    return new ElementHandle(this.frame, selector, this._joinSelfSelector())
  }
  /**
   * 基于当前节点，查询新的节点集合, 对应elm.querySelectorAll(selector)
   * @param {string} selector
   *
   * @return {Promise&lt;ElementHandle[]>}
   */
  $$(selector) {
    return this.ipc
      .send("elementHandle.$$", {
        selector: selector,
        baseSelector: this._joinSelfSelector(),
      })
      .then((length) => {
        return new Array(length).map((v, i) => {
          return new ElementHandle(
            this.contentFrame(),
            [selector, i],
            this._joinSelfSelector(),
          )
        })
      })
  }
  /**
   * 查找节点，并将查找的节点作为参数传为pageFunction
   * @param {string} selector
   * @param {Function} pageFunction
   *
   * @return {Promise&lt;*>}
   */
  $eval(selector, pageFunction) {
    var args = [].slice.call(arguments, 1).map((arg) => {
      return JSON.stringify(arg)
    })

    return this.ipc.send("elementHandle.$eval", {
      selector: selector,
      baseSelector: this._joinSelfSelector(),
      pageFunction: pageFunction.toString(),
      args: args,
    })
  }
  /**
   * 查找节点集合，并将查找的节点集合作为参数传为pageFunction
   * @param {string} selector
   * @param {Function} pageFunction
   *
   * @return {Promise&lt;*>}
   */
  $$eval(selector, pageFunction) {
    var args = [].slice.call(arguments, 1).map(function (arg) {
      return JSON.stringify(arg)
    })

    return this.ipc.send("elementHandle.$$eval", {
      selector: selector,
      baseSelector: this._joinSelfSelector(),
      pageFunction: pageFunction.toString(),
      args: args,
    })
  }
  /**
   * todo
   */
  $x(/* expression */) {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  asElement() {
    return Promise.reject("todo")
  }
  /**
   * getBoundingClientRect
   *
   * @return {Promise&lt;Object>}
   */
  getBoundingClientRect() {
    return this.ipc.send("elementHandle.getBoundingClientRect", {
      selector: selector,
      baseSelector: this.baseSelector,
    })
  }
  /**
   * todo
   */
  boxModel() {
    return Promise.reject("todo")
  }
  /**
   * 点击当前节点
   * @param {*} options 暂不支持
   *
   * @return {Promise&lt;undefined>}
   */
  click(options) {
    return this.ipc.send("elementHandle.click", {
      selector: this._joinSelfSelector(),
      options,
    })
  }
  /**
   * 当前节点所属frame
   *
   * @return {Frame}
   */
  contentFrame() {
    return this.frame
  }
  /**
   * todo
   */
  dispose() {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  executionContext() {
    return Promise.reject("todo")
  }
  /**
   * 设置checked属性为true，并触发change事件
   *
   * @return {Promise&lt;undefined>}
   */
  check() {
    return this.ipc.send("elementHandle.check", {
      selector: this._joinSelfSelector(),
    })
  }
  /**
   * 设置checked属性为false，并触发change事件
   *
   * @return {Promise&lt;undefined>}
   */
  uncheck() {
    return this.ipc.send("elementHandle.uncheck", {
      selector: this._joinSelfSelector(),
    })
  }
  /**
   * todo
   */
  getProperties() {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  getProperty(/* propertyName */) {
    return Promise.reject("todo")
  }
  /**
   * focus当前节点
   *
   * @return {Promise&lt;undefined>}
   */
  focus() {
    // console.log('focus: ', this._joinSelfSelector());
    return this.ipc.send("elementHandle.focus", {
      selector: this._joinSelfSelector(),
    })
  }
  /**
   * 取消聚焦当前节点
   *
   * @return {Promise&lt;undefined>}
   */
  // @noitce puppeteer不支持blur
  blur() {
    return this.ipc.send("elementHandle.blur", {
      selector: this._joinSelfSelector(),
    })
  }
  /**
   * 获取节点的属性集合
   *
   * @return {Promise&lt;Map&lt;string, Object>>}
   */
  getAttributes() {
    return this.ipc
      .send("elementHandle.getAttributes", {
        selector: this._joinSelfSelector(),
      })
      .then(function (attributes) {
        var map = new Map()
        for (var attr of attributes) {
          if (attributes.hasOwnProperty(attr)) {
            map.set(attr, {
              // @notice: 先简单实现
              jsonValue: (function (value) {
                return value
              })(attributes[attr]),
            })
          }
        }
        return map
      })
  }
  /**
   * 获取节点的指定属性值
   *
   * @return {Promise&lt;Object>} 通过jsonValue()获取属性值
   */
  getAttribute(attrName) {
    return this.ipc
      .send("elementHandle.getAttribute", {
        selector: this._joinSelfSelector(),
        attrName: attrName,
      })
      .then(function (value) {
        // @notice: 先简单实现
        return {
          jsonValue: function () {
            return value
          },
        }
      })
  }
  /**
   * hover当前节点
   *
   * @return {Promise&lt;undefined>}
   */
  hover() {
    return this.ipc.send("elementHandle.hover", {
      selector: this._joinSelfSelector(),
    })
  }
  /**
   * todo
   */
  isIntersectingViewport() {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  jsonValue() {
    return Promise.reject("todo")
  }
  /**
   * 键入文本
   * @param {string} text 输入的文本内容, 暂时只支持单字符输入，即英文字母等
   * @param {*} options 暂不支持
   */
  // todo: 暂不支持options
  // todo： 暂只支持文字输入、Backspace、Enter
  press(text, options) {
    var key = USKeyboardLayout[text]
    if (!key) {
      return Promise.reject("key not define")
    }

    return this.ipc.send("elementHandle.press", {
      selector: this._joinSelfSelector(),
      keyCode: key.keyCode,
      text: text,
      options: options,
    })
  }
  /**
   * todo
   */
  screenshot(/* options */) {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  tap() {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  toString() {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  type(/* text, options */) {
    return Promise.reject("todo")
  }
  /**
   * todo
   */
  uploadFile(/* ...filePaths */) {
    return Promise.reject("todo")
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon May 11 2020 10:53:34 GMT+0800 (GMT+08:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
