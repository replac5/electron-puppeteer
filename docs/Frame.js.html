<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Frame.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Browser.html">Browser</a><ul class='methods'><li data-type='method'><a href="Browser.html#init">init</a></li><li data-type='method'><a href="Browser.html#getBoundingClientRect">getBoundingClientRect</a></li><li data-type='method'><a href="Browser.html#build">build</a></li><li data-type='method'><a href="Browser.html#_handleWindowPage">_handleWindowPage</a></li><li data-type='method'><a href="Browser.html#bringToFront">bringToFront</a></li><li data-type='method'><a href="Browser.html#close">close</a></li><li data-type='method'><a href="Browser.html#pages">pages</a></li><li data-type='method'><a href="Browser.html#getPageById">getPageById</a></li><li data-type='method'><a href="Browser.html#frontPage">frontPage</a></li><li data-type='method'><a href="Browser.html#newPage">newPage</a></li><li data-type='method'><a href="Browser.html#_setCtrlIcons">_setCtrlIcons</a></li><li data-type='method'><a href="Browser.html#_newPageWithoutReady">_newPageWithoutReady</a></li></ul></li><li></li><li><a href="BrowserManager.html">BrowserManager</a><ul class='methods'><li data-type='method'><a href="BrowserManager.html#launch">launch</a></li><li data-type='method'><a href="BrowserManager.html#getEarliest">getEarliest</a></li><li data-type='method'><a href="BrowserManager.html#get">get</a></li><li data-type='method'><a href="BrowserManager.html#frontBrowser">frontBrowser</a></li></ul></li><li></li><li><a href="ElementHandle.html">ElementHandle</a><ul class='methods'><li data-type='method'><a href="ElementHandle.html#$">$</a></li><li data-type='method'><a href="ElementHandle.html#$$">$$</a></li><li data-type='method'><a href="ElementHandle.html#$eval">$eval</a></li><li data-type='method'><a href="ElementHandle.html#$$eval">$$eval</a></li><li data-type='method'><a href="ElementHandle.html#$x">$x</a></li><li data-type='method'><a href="ElementHandle.html#asElement">asElement</a></li><li data-type='method'><a href="ElementHandle.html#boundingBox">boundingBox</a></li><li data-type='method'><a href="ElementHandle.html#textContent">textContent</a></li><li data-type='method'><a href="ElementHandle.html#boxModel">boxModel</a></li><li data-type='method'><a href="ElementHandle.html#click">click</a></li><li data-type='method'><a href="ElementHandle.html#show">show</a></li><li data-type='method'><a href="ElementHandle.html#hide">hide</a></li><li data-type='method'><a href="ElementHandle.html#contentFrame">contentFrame</a></li><li data-type='method'><a href="ElementHandle.html#dispose">dispose</a></li><li data-type='method'><a href="ElementHandle.html#executionContext">executionContext</a></li><li data-type='method'><a href="ElementHandle.html#check">check</a></li><li data-type='method'><a href="ElementHandle.html#uncheck">uncheck</a></li><li data-type='method'><a href="ElementHandle.html#getProperties">getProperties</a></li><li data-type='method'><a href="ElementHandle.html#getProperty">getProperty</a></li><li data-type='method'><a href="ElementHandle.html#focus">focus</a></li><li data-type='method'><a href="ElementHandle.html#blur">blur</a></li><li data-type='method'><a href="ElementHandle.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="ElementHandle.html#getAttribute">getAttribute</a></li><li data-type='method'><a href="ElementHandle.html#hover">hover</a></li><li data-type='method'><a href="ElementHandle.html#isIntersectingViewport">isIntersectingViewport</a></li><li data-type='method'><a href="ElementHandle.html#jsonValue">jsonValue</a></li><li data-type='method'><a href="ElementHandle.html#press">press</a></li><li data-type='method'><a href="ElementHandle.html#screenshot">screenshot</a></li><li data-type='method'><a href="ElementHandle.html#tap">tap</a></li><li data-type='method'><a href="ElementHandle.html#toString">toString</a></li><li data-type='method'><a href="ElementHandle.html#type">type</a></li><li data-type='method'><a href="ElementHandle.html#uploadFile">uploadFile</a></li></ul></li><li></li><li><a href="EventEmitter.html">EventEmitter</a><ul class='methods'><li data-type='method'><a href="EventEmitter.html#.noConflict">noConflict</a></li></ul></li><li><a href="Frame.html">Frame</a><ul class='methods'><li data-type='method'><a href="Frame.html#addScriptTag">addScriptTag</a></li><li data-type='method'><a href="Frame.html#addStyleTag">addStyleTag</a></li><li data-type='method'><a href="Frame.html#childFrames">childFrames</a></li><li data-type='method'><a href="Frame.html#content">content</a></li><li data-type='method'><a href="Frame.html#evaluate">evaluate</a></li><li data-type='method'><a href="Frame.html#goto">goto</a></li><li data-type='method'><a href="Frame.html#isDetached">isDetached</a></li><li data-type='method'><a href="Frame.html#name">name</a></li><li data-type='method'><a href="Frame.html#page">page</a></li><li data-type='method'><a href="Frame.html#parentFrame">parentFrame</a></li><li data-type='method'><a href="Frame.html#select">select</a></li><li data-type='method'><a href="Frame.html#setContent">setContent</a></li><li data-type='method'><a href="Frame.html#title">title</a></li><li data-type='method'><a href="Frame.html#type">type</a></li><li data-type='method'><a href="Frame.html#press">press</a></li><li data-type='method'><a href="Frame.html#url">url</a></li><li data-type='method'><a href="Frame.html#waitFor">waitFor</a></li><li data-type='method'><a href="Frame.html#waitForFunction">waitForFunction</a></li><li data-type='method'><a href="Frame.html#waitForNavigation">waitForNavigation</a></li><li data-type='method'><a href="Frame.html#waitForNavigationOut">waitForNavigationOut</a></li><li data-type='method'><a href="Frame.html#waitForNavigationTo">waitForNavigationTo</a></li><li data-type='method'><a href="Frame.html#waitForSelector">waitForSelector</a></li><li data-type='method'><a href="Frame.html#hasElement">hasElement</a></li><li data-type='method'><a href="Frame.html#waitForXPath">waitForXPath</a></li><li data-type='method'><a href="Frame.html#click">click</a></li><li data-type='method'><a href="Frame.html#focus">focus</a></li><li data-type='method'><a href="Frame.html#blur">blur</a></li><li data-type='method'><a href="Frame.html#hover">hover</a></li><li data-type='method'><a href="Frame.html#tap">tap</a></li><li data-type='method'><a href="Frame.html#localStorageKeys">localStorageKeys</a></li><li data-type='method'><a href="Frame.html#localStorageGet">localStorageGet</a></li><li data-type='method'><a href="Frame.html#localStorageSet">localStorageSet</a></li><li data-type='method'><a href="Frame.html#localStorageRemove">localStorageRemove</a></li><li data-type='method'><a href="Frame.html#$">$</a></li><li data-type='method'><a href="Frame.html#$$">$$</a></li><li data-type='method'><a href="Frame.html#$eval">$eval</a></li><li data-type='method'><a href="Frame.html#$$eval">$$eval</a></li><li data-type='method'><a href="Frame.html#$x">$x</a></li></ul></li><li></li><li><a href="Page.html">Page</a><ul class='methods'><li data-type='method'><a href="Page.html#init">init</a></li><li data-type='method'><a href="Page.html#build">build</a></li><li data-type='method'><a href="Page.html#isLoading">isLoading</a></li><li data-type='method'><a href="Page.html#isLoadingMainFrame">isLoadingMainFrame</a></li><li data-type='method'><a href="Page.html#bringToFront">bringToFront</a></li><li data-type='method'><a href="Page.html#browser">browser</a></li><li data-type='method'><a href="Page.html#close">close</a></li><li data-type='method'><a href="Page.html#cookie">cookie</a></li><li data-type='method'><a href="Page.html#cookies">cookies</a></li><li data-type='method'><a href="Page.html#deleteCookies">deleteCookies</a></li><li data-type='method'><a href="Page.html#frames">frames</a></li><li data-type='method'><a href="Page.html#canGoBack">canGoBack</a></li><li data-type='method'><a href="Page.html#canGoForward">canGoForward</a></li><li data-type='method'><a href="Page.html#goBack">goBack</a></li><li data-type='method'><a href="Page.html#goForward">goForward</a></li><li data-type='method'><a href="Page.html#isClosed">isClosed</a></li><li data-type='method'><a href="Page.html#mainFrame">mainFrame</a></li><li data-type='method'><a href="Page.html#find">find</a></li><li data-type='method'><a href="Page.html#reload">reload</a></li><li data-type='method'><a href="Page.html#screenshot">screenshot</a></li><li data-type='method'><a href="Page.html#setCookie">setCookie</a></li><li data-type='method'><a href="Page.html#clearHistory">clearHistory</a></li><li data-type='method'><a href="Page.html#waitForRequest">waitForRequest</a></li><li data-type='method'><a href="Page.html#waitForResponse">waitForResponse</a></li><li data-type='method'><a href="Page.html#evaluateHandle">evaluateHandle</a></li><li data-type='method'><a href="Page.html#queryObjects">queryObjects</a></li><li data-type='method'><a href="Page.html#target">target</a></li><li data-type='method'><a href="Page.html#_initWindowProxy">_initWindowProxy</a></li><li data-type='method'><a href="Page.html#$">$</a></li><li data-type='method'><a href="Page.html#$$">$$</a></li><li data-type='method'><a href="Page.html#$eval">$eval</a></li><li data-type='method'><a href="Page.html#$$eval">$$eval</a></li><li data-type='method'><a href="Page.html#$x">$x</a></li><li data-type='method'><a href="Page.html#addScriptTag">addScriptTag</a></li><li data-type='method'><a href="Page.html#addStyleTag">addStyleTag</a></li><li data-type='method'><a href="Page.html#click">click</a></li><li data-type='method'><a href="Page.html#content">content</a></li><li data-type='method'><a href="Page.html#evaluate">evaluate</a></li><li data-type='method'><a href="Page.html#focus">focus</a></li><li data-type='method'><a href="Page.html#hover">hover</a></li><li data-type='method'><a href="Page.html#goto">goto</a></li><li data-type='method'><a href="Page.html#select">select</a></li><li data-type='method'><a href="Page.html#setContent">setContent</a></li><li data-type='method'><a href="Page.html#tap">tap</a></li><li data-type='method'><a href="Page.html#title">title</a></li><li data-type='method'><a href="Page.html#type">type</a></li><li data-type='method'><a href="Page.html#press">press</a></li><li data-type='method'><a href="Page.html#url">url</a></li><li data-type='method'><a href="Page.html#waitFor">waitFor</a></li><li data-type='method'><a href="Page.html#waitForFunction">waitForFunction</a></li><li data-type='method'><a href="Page.html#waitForNavigation">waitForNavigation</a></li><li data-type='method'><a href="Page.html#waitForNavigationOut">waitForNavigationOut</a></li><li data-type='method'><a href="Page.html#waitForNavigationTo">waitForNavigationTo</a></li><li data-type='method'><a href="Page.html#waitForSelector">waitForSelector</a></li><li data-type='method'><a href="Page.html#hasElement">hasElement</a></li><li data-type='method'><a href="Page.html#waitForXPath">waitForXPath</a></li><li data-type='method'><a href="Page.html#localStorageKeys">localStorageKeys</a></li><li data-type='method'><a href="Page.html#localStorageGet">localStorageGet</a></li><li data-type='method'><a href="Page.html#localStorageSet">localStorageSet</a></li><li data-type='method'><a href="Page.html#localStorageRemove">localStorageRemove</a></li></ul></li><li></li><li><a href="WindowPage.html">WindowPage</a><ul class='methods'><li data-type='method'><a href="WindowPage.html#init">init</a></li><li data-type='method'><a href="WindowPage.html#build">build</a></li><li data-type='method'><a href="WindowPage.html#isLoading">isLoading</a></li><li data-type='method'><a href="WindowPage.html#isLoadingMainFrame">isLoadingMainFrame</a></li><li data-type='method'><a href="WindowPage.html#bringToFront">bringToFront</a></li><li data-type='method'><a href="WindowPage.html#browser">browser</a></li><li data-type='method'><a href="WindowPage.html#close">close</a></li><li data-type='method'><a href="WindowPage.html#cookie">cookie</a></li><li data-type='method'><a href="WindowPage.html#cookies">cookies</a></li><li data-type='method'><a href="WindowPage.html#deleteCookies">deleteCookies</a></li><li data-type='method'><a href="WindowPage.html#frames">frames</a></li><li data-type='method'><a href="WindowPage.html#canGoBack">canGoBack</a></li><li data-type='method'><a href="WindowPage.html#canGoForward">canGoForward</a></li><li data-type='method'><a href="WindowPage.html#goBack">goBack</a></li><li data-type='method'><a href="WindowPage.html#goForward">goForward</a></li><li data-type='method'><a href="WindowPage.html#isClosed">isClosed</a></li><li data-type='method'><a href="WindowPage.html#mainFrame">mainFrame</a></li><li data-type='method'><a href="WindowPage.html#find">find</a></li><li data-type='method'><a href="WindowPage.html#reload">reload</a></li><li data-type='method'><a href="WindowPage.html#screenshot">screenshot</a></li><li data-type='method'><a href="WindowPage.html#setCookie">setCookie</a></li><li data-type='method'><a href="WindowPage.html#clearHistory">clearHistory</a></li><li data-type='method'><a href="WindowPage.html#waitForRequest">waitForRequest</a></li><li data-type='method'><a href="WindowPage.html#waitForResponse">waitForResponse</a></li><li data-type='method'><a href="WindowPage.html#evaluateHandle">evaluateHandle</a></li><li data-type='method'><a href="WindowPage.html#queryObjects">queryObjects</a></li><li data-type='method'><a href="WindowPage.html#target">target</a></li><li data-type='method'><a href="WindowPage.html#_initWindowProxy">_initWindowProxy</a></li><li data-type='method'><a href="WindowPage.html#$">$</a></li><li data-type='method'><a href="WindowPage.html#$$">$$</a></li><li data-type='method'><a href="WindowPage.html#$eval">$eval</a></li><li data-type='method'><a href="WindowPage.html#$$eval">$$eval</a></li><li data-type='method'><a href="WindowPage.html#$x">$x</a></li><li data-type='method'><a href="WindowPage.html#addScriptTag">addScriptTag</a></li><li data-type='method'><a href="WindowPage.html#addStyleTag">addStyleTag</a></li><li data-type='method'><a href="WindowPage.html#click">click</a></li><li data-type='method'><a href="WindowPage.html#content">content</a></li><li data-type='method'><a href="WindowPage.html#evaluate">evaluate</a></li><li data-type='method'><a href="WindowPage.html#focus">focus</a></li><li data-type='method'><a href="WindowPage.html#hover">hover</a></li><li data-type='method'><a href="WindowPage.html#goto">goto</a></li><li data-type='method'><a href="WindowPage.html#select">select</a></li><li data-type='method'><a href="WindowPage.html#setContent">setContent</a></li><li data-type='method'><a href="WindowPage.html#tap">tap</a></li><li data-type='method'><a href="WindowPage.html#title">title</a></li><li data-type='method'><a href="WindowPage.html#type">type</a></li><li data-type='method'><a href="WindowPage.html#press">press</a></li><li data-type='method'><a href="WindowPage.html#url">url</a></li><li data-type='method'><a href="WindowPage.html#waitFor">waitFor</a></li><li data-type='method'><a href="WindowPage.html#waitForFunction">waitForFunction</a></li><li data-type='method'><a href="WindowPage.html#waitForNavigation">waitForNavigation</a></li><li data-type='method'><a href="WindowPage.html#waitForNavigationOut">waitForNavigationOut</a></li><li data-type='method'><a href="WindowPage.html#waitForNavigationTo">waitForNavigationTo</a></li><li data-type='method'><a href="WindowPage.html#waitForSelector">waitForSelector</a></li><li data-type='method'><a href="WindowPage.html#hasElement">hasElement</a></li><li data-type='method'><a href="WindowPage.html#waitForXPath">waitForXPath</a></li><li data-type='method'><a href="WindowPage.html#localStorageKeys">localStorageKeys</a></li><li data-type='method'><a href="WindowPage.html#localStorageGet">localStorageGet</a></li><li data-type='method'><a href="WindowPage.html#localStorageSet">localStorageSet</a></li><li data-type='method'><a href="WindowPage.html#localStorageRemove">localStorageRemove</a></li></ul></li><li><a href="Target.html">Target</a><ul class='methods'><li data-type='method'><a href="Target.html#browser">browser</a></li><li data-type='method'><a href="Target.html#opener">opener</a></li><li data-type='method'><a href="Target.html#page">page</a></li><li data-type='method'><a href="Target.html#type">type</a></li><li data-type='method'><a href="Target.html#url">url</a></li></ul></li><li></li><li><a href="Ipc.html">Ipc</a><ul class='methods'><li data-type='method'><a href="Ipc.html#send">send</a></li><li data-type='method'><a href="Ipc.html#sendOn">sendOn</a></li><li data-type='method'><a href="Ipc.html#on">on</a></li><li data-type='method'><a href="Ipc.html#once">once</a></li><li data-type='method'><a href="Ipc.html#off">off</a></li><li data-type='method'><a href="Ipc.html#dispatch">dispatch</a></li></ul></li><li></li><li><a href="BoundIpc.html">BoundIpc</a><ul class='methods'><li data-type='method'><a href="BoundIpc.html#send">send</a></li><li data-type='method'><a href="BoundIpc.html#sendOn">sendOn</a></li><li data-type='method'><a href="BoundIpc.html#on">on</a></li><li data-type='method'><a href="BoundIpc.html#once">once</a></li><li data-type='method'><a href="BoundIpc.html#off">off</a></li><li data-type='method'><a href="BoundIpc.html#dispatch">dispatch</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="Browser.html#event:back">back</a></li><li><a href="Browser.html#event:front">front</a></li><li><a href="Browser.html#event:close">close</a></li><li><a href="Browser.html#event:new-page">new-page</a></li><li><a href="Browser.html#event:targetcreated">targetcreated</a></li><li><a href="Browser.html#event:targetchanged">targetchanged</a></li><li><a href="Browser.html#event:targetdestroyed">targetdestroyed</a></li><li><a href="Page.html#event:dom-event">dom-event</a></li><li><a href="Page.html#event:frameattached">frameattached</a></li><li><a href="Page.html#event:framenavigated">framenavigated</a></li><li><a href="Page.html#event:connect">connect</a></li><li><a href="Page.html#event:framedetached">framedetached</a></li><li><a href="Page.html#event:disconnect">disconnect</a></li><li><a href="Page.html#event:load-start">load-start</a></li><li><a href="Page.html#event:load-fail">load-fail</a></li><li><a href="Page.html#event:load-end">load-end</a></li><li><a href="Page.html#event:title-updated">title-updated</a></li><li><a href="Page.html#event:favicon-updated">favicon-updated</a></li><li><a href="Page.html#event:console">console</a></li><li><a href="Page.html#event:new-window">new-window</a></li><li><a href="Page.html#event:will-navigate">will-navigate</a></li><li><a href="Page.html#event:dom-ready">dom-ready</a></li><li><a href="Page.html#event:load">load</a></li><li><a href="Page.html#event:domcontentloaded">domcontentloaded</a></li><li><a href="Page.html#event:historyNavigation">historyNavigation</a></li><li><a href="Page.html#event:hashchange">hashchange</a></li><li></li><li><a href="Page.html#event:back">back</a></li><li><a href="Page.html#event:front">front</a></li><li><a href="Page.html#event:close">close</a></li><li><a href="WindowPage.html#event:dom-event">dom-event</a></li><li><a href="WindowPage.html#event:frameattached">frameattached</a></li><li><a href="WindowPage.html#event:framenavigated">framenavigated</a></li><li><a href="WindowPage.html#event:connect">connect</a></li><li><a href="WindowPage.html#event:framedetached">framedetached</a></li><li><a href="WindowPage.html#event:disconnect">disconnect</a></li><li><a href="WindowPage.html#event:load-start">load-start</a></li><li><a href="WindowPage.html#event:load-fail">load-fail</a></li><li><a href="WindowPage.html#event:load-end">load-end</a></li><li><a href="WindowPage.html#event:title-updated">title-updated</a></li><li><a href="WindowPage.html#event:favicon-updated">favicon-updated</a></li><li><a href="WindowPage.html#event:console">console</a></li><li><a href="WindowPage.html#event:new-window">new-window</a></li><li><a href="WindowPage.html#event:will-navigate">will-navigate</a></li><li><a href="WindowPage.html#event:dom-ready">dom-ready</a></li><li><a href="WindowPage.html#event:load">load</a></li><li><a href="WindowPage.html#event:domcontentloaded">domcontentloaded</a></li><li><a href="WindowPage.html#event:historyNavigation">historyNavigation</a></li><li><a href="WindowPage.html#event:hashchange">hashchange</a></li><li><a href="WindowPage.html#event:back">back</a></li><li><a href="WindowPage.html#event:front">front</a></li><li><a href="WindowPage.html#event:close">close</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_onRequestPaused">_onRequestPaused</a></li><li><a href="global.html#_onRequest">_onRequest</a></li><li><a href="global.html#_onRequestServedFromCache">_onRequestServedFromCache</a></li><li><a href="global.html#setCacheEnabled">setCacheEnabled</a></li><li><a href="global.html#setRequestInterception">setRequestInterception</a></li><li><a href="global.html#headersArray">headersArray</a></li><li><a href="global.html#urlMatch">urlMatch</a></li><li><a href="global.html#reqUpdater">reqUpdater</a></li><li><a href="global.html#resUpdater">resUpdater</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Frame.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import EventEmitter from "./EventEmitter.js"
import ElementHandle from "./ElementHandle.js"
import {BoundIpc} from "./ipc.js"
import {isFunction, TimeoutPromise, proxyBindDecorator} from "./util.js"

/**
 * @class Frame Frame类，webview的iframe，主页面是mainFrame
 * @extends EventEmitter
 *
 * @property {WebviewTag} webview
 * @property {boolean} isMainFrame 是否mainFrame
 * @property {Ipc} ipc ipc通信实例，可用于和webview内内容通信
 * @property {ElementHandle} document 当前frame的document操作句柄
 *
 */
class Frame extends EventEmitter {
  /**
   * @typedef FrameInfo frame信息
   * @property {string} FrameInfo.UUID iframe的UUID值
   * @property {string} FrameInfo.name iframe的name值
   * @property {boolean} FrameInfo.isMainFrame 是否为mainFrame
   * @property {FrameInfo} FrameInfo.parent 父的frame的信息
   */

  /**
   *
   * @constructor Frame
   * @param {Page} page 所属page实例
   * @param {WebviewTag} webviewElement webview节点
   * @param {FrameInfo} frameInfo frame的信息
   */
  constructor(page, webviewElement, frameInfo) {
    super()

    this._frameInfo = frameInfo
    this._url = frameInfo.url || ""

    this._page = page
    this.webview = webviewElement
    // webview的webContentsId
    this.webContentsId = frameInfo.webContentsId
    this.routingId = frameInfo.routingId
    this.isMainFrame = frameInfo.isMainFrame
    this.ipc = new BoundIpc(this.webview, frameInfo.UUID)
    this.document = new ElementHandle(this, "document", [])

    this._childFrames = []
    this._listenChildFramesRegister()
    this._listenChildFramesUnregister()
    this._listenFrameContentEvents()
  }
  // 监听当前frame下子iframe的注册事件
  _listenChildFramesRegister() {
    this.ipc.on("childFrame.register", (frameInfo) => {
      let originInfo = this._childFrames.find(
        (item) => item.UUID === frameInfo.UUID
      )
      if (originInfo) {
        Object.assign(originInfo, frameInfo)
      } else {
        this._childFrames.push(frameInfo)
      }
    })
  }
  // 监听当前frame下子iframe的注销事件
  _listenChildFramesUnregister() {
    this.ipc.on("childFrame.unregister", (frameInfo) => {
      this._childFrames = this._childFrames.filter(
        (item) => item.UUID !== frameInfo.UUID
      )
    })
  }
  _listenFrameContentEvents() {
    this.ipc.on("frame.event", (payload) => {
      /**
       * frame dom 事件
       * @event Page#dom-event
       * @type {Object}
       * @property {string} type 事件类型
       * @property {Object} event 事件对象的部分属性
       * @property {Object} target event.taget.target的部分属性
       */
      this.emit("dom-event", payload)
    })
  }
  /**
   * 注入一个指定url或(content)的script标签到页面
   * @param {Object} options
   * @property {string} [options.url] 要添加的script的src
   * @property {string} [options.content] 要注入页面的js代码
   * @property {boolean} [options.waitLoad] 如果是url，等待onload回调
   * @property {string} [options.type] type属性，如果要注入 ES6 module，值为'module'
   *
   * @return {Promise&lt;ElementHandle>} 返回注入脚本的dom句柄实例
   */
  addScriptTag(options) {
    return this.ipc.send("frame.addScriptTag", options)
  }
  /**
   * 注入一个link(url)或style(content)标签到页面
   * @param {Object} options
   * @property {string} [options.id] 样式的id，相同id的style不会重复添加到页面
   * @property {string} [options.url] 要添加的css link的src
   * @property {string} [options.content] 要注入页面的style代码
   * @property {boolean} [options.force] 在id相同时强制重新添加style到页面
   *
   * @return {Promise&lt;ElementHandle>} 返回注入样式的dom句柄实例
   */
  addStyleTag(options) {
    return this.ipc.send("frame.addStyleTag", options)
  }
  /**
   * 获取当前frame
   */
  childFrames() {
    return this._childFrames.map(
      (info) =>
        new Frame(this._page, this.webview, {
          ...info,
          parent: this._frameInfo,
        })
    )
  }
  /**
   * todo
   * 获取frame的内容
   *
   * @return {string}
   */
  content() {
    return this.ipc.send("frame.content")
  }
  /**
   * 在frame运行指定函数
   * @param {Function} pageFunction
   * @param {string[]|number[]} args 传给pageFunction的参数
   * @param {number|Object} [options]  等待超时时间
   *
   * @return {Promise&lt;*>} 返回运行结果，若pageFunction返回Promise，会等待Promise的resolve结果
   */
  evaluate(pageFunction, args, options) {
    if (!Array.isArray(args)) {
      options = args
      args = []
    }
    let retry = 0
    let timeout = options
    let name = ""
    if (Object.prototype.toString.call(options) === "[object Object]") {
      retry = options.retry || 0
      timeout = options.timeout
      name = options.name
    }
    timeout = timeout || 1e4

    if (typeof pageFunction == "string") {
      pageFunction = "function() {return " + pageFunction + "}"
    }

    return this.ipc.send(
      "frame.evaluate",
      {pageFunction: pageFunction.toString(), args: args, name: name},
      timeout,
      retry
    )
  }
  /**
   * 控制当前frame跳转到指定url
   * 会在超时时间内追踪重定向，直到跳转到最终页面
   * @param {string} url
   * @param {Object} [options]
   * @property {string} [options.waitUntil] 认定跳转成功的事件类型 load|domcontentloaded|hashchange|historyNavigation，默认为domcontentloaded
   * @property {boolean} [options.reload] 刷新
   * @property {number} [options.timeout] 超时时间，单位为ms，默认为10000ms
   * @property {number} [options.retry] 重试次数，默认不重试, 重试仅在发送超时的情况
   *
   * @return {Promise&lt;undefined>}
   */
  async goto(url, options) {
    let timeout = (options &amp;&amp; options.timeout) || 1e4
    var waitUntil = (options &amp;&amp; options.waitUntil) || "domcontentloaded"

    // 递归获取最终的跳转地址
    // timeout计时结束后就停止监听跳转
    var redirectURL = url
    const _getRedirectUrl = () => {
      this.page().webRequest.onBeforeRedirect(
        {
          urls: ["http://*/*", "https://*/*"],
        },
        (details) => {
          if (details.url === redirectURL) {
            redirectURL = details.redirectURL
            // console.log('onBeforeRedirect: ', redirectURL)
          }
        }
      )
    }
    _getRedirectUrl()

    await this.ipc.send("frame.goto", {
      url: url,
      reload: options &amp;&amp; options.reload,
    })

    return new TimeoutPromise((resolve) => {
      this.ipc.on("frame.goto." + waitUntil, (payload) => {
        if (
          (redirectURL.startsWith("/") &amp;&amp; payload.relative === redirectURL) ||
          (redirectURL.startsWith("?") &amp;&amp; payload.query === redirectURL) ||
          (redirectURL.startsWith("#") &amp;&amp;
            (payload.hash === redirectURL ||
              payload.hash.split("?").shift())) ||
          payload.url === redirectURL
        ) {
          resolve(payload)
        }
      })
    }, timeout).catch((err) => {
      if (err === "promise.timeout") {
        if (!options || !options.retry || options.retry &lt;= 0) {
          return Promise.reject("goto.timeout")
        } else {
          return this.goto(url, {
            ...options,
            retry: options.retry - 1,
          })
        }
      }
      return Promise.reject(err)
    })
  }
  /**
   * todo
   */
  isDetached() {
    return Promise.reject("todo")
  }
  /**
   * frame的名称
   *
   * @return {string}
   */
  name() {
    return this._frameInfo.name
  }
  /**
   * frame所属的page实例
   *
   * @return {Page}
   */
  page() {
    return this._page
  }
  /**
   * frame的parentFrame
   * 如果当前frame为mainFrame，返回null
   *
   * @return {Frame}
   */
  parentFrame() {
    if (this._frameInfo.parent) {
      return new Frame(this._page, this.webview, this._frameInfo.parent)
    }
    return null
  }
  /**
   * todo
   */
  select() {
    return Promise.reject("todo")
  }
  /**
   * todo
   * 设置页面内容
   * @param {string} html
   *
   * @return {Promise&lt;undefined>}
   */
  setContent(html) {
    return this.ipc.send("frame.setContent", html)
  }
  /**
   * frame的标题
   *
   * @return {string}
   */
  title() {
    if (this.isMainFrame) {
      return this.webview.getTitle()
    }

    return this.ipc.send("frame.title")
  }
  /**
   * 输入指定内容
   * @param {string} selector 要输入的dom的选择，input或textarea
   * @param {string} text 输入的文本
   * @param {Object} [options]
   * @property {number} [options.delay] 延迟输入, 操作更像用户
   */
  type(selector, text, options) {
    return this.document.$(selector).type(text, options)
  }
  /**
   * 输入指定内容
   * @param {string} selector 要输入的dom的选择，input或textarea
   * @param {string} press 输入的文本
   * @param {Object} [options]
   */
  press(selector, text, options) {
    return this.document.$(selector).press(text, options)
  }
  /**
   * 获取url，如果是mainFrame为当前url，如果是iframe，则是src属性
   *
   * @return {string}
   */
  url() {
    let url
    if (this.isMainFrame) {
      try {
        if (!this.webview.isCrashed()) {
          url = this.webview.getURL()
        }
      } catch {}
    }
    return url || this._frameInfo.url
  }
  /**
   * waitForSelector|waitForFunction|setTimeout的结合体
   * @param {string|number|Function} selectorOrFunctionOrTimeout
   * @param {Object} options
   * @param  {...any} args
   */
  waitFor(selectorOrFunctionOrTimeout, options, ...args) {
    if (typeof selectorOrFunctionOrTimeout === "string") {
      return this.waitForSelector(selectorOrFunctionOrTimeout, options)
    } else if (typeof selectorOrFunctionOrTimeout === "number") {
      return new Promise((resolve) => {
        setTimeout(resolve, selectorOrFunctionOrTimeout)
      })
    } else {
      return this.waitForFunction(selectorOrFunctionOrTimeout, options, ...args)
    }
  }
  /**
   * 在指定时间内轮询执行方法，直到方法返回true
   * @param {Function} pageFunction
   * @param {Object} [options]
   * @property {number} [options.timeout] 等待时间
   * @property {number} [options.retry] 重试次数，默认不重试, 重试仅在发送超时的情况
   * @param  {...any} args
   *
   * @return {Promise&lt;boolean>} 成功返回resove(true)，超时返回reject
   */
  waitForFunction(pageFunction, options, ...args) {
    if (typeof pageFunction == "string") {
      pageFunction = "function() {return " + pageFunction + "}"
    }

    return this.ipc.send(
      "frame.waitForFunction",
      {
        pageFunction: pageFunction.toString(),
        args: args,
        options,
      },
      options &amp;&amp; options.timeout,
      options &amp;&amp; options.retry
    )
  }
  /**
   * 等待跳转完成
   * @param {Object} [options]
   * @property {string} [options.waitUntil] 认定跳转成功的事件类型 load|domcontentloaded|historyNavigation，默认为domcontentloaded
   * @property {number} [options.timeout] 超时时间，单位为ms，默认为10000ms
   *
   * @return {Promise&lt;Object>} 返回跳转后frame的信息
   */
  waitForNavigation(options) {
    return new TimeoutPromise((resolve) => {
      var waitUntil = (options &amp;&amp; options.waitUntil) || "domcontentloaded"
      this.ipc.once("frame.waitForNavigation." + waitUntil, function (param) {
        resolve(param)
      })
    }, (options &amp;&amp; options.timeout) || 1e4).catch((err) => {
      if (err === "promise.timeout") {
        return Promise.reject("waitForNavigation.timeout")
      }
      return Promise.reject(err)
    })
  }
  /**
   * 等待url跳出，不会等待跳转的页面的加载事件
   * @param {Object} [options]
   * @property {string|Function} [options.url] 要跳出的url|检查当前url和跳出url是否匹配的函数
   * @property {number} [options.timeout] 超时时间，单位为ms，默认为10000ms
   *
   * @return {Promise&lt;boolean>}
   */
  waitForNavigationOut(options) {
    if (!options || !options.url) {
      return Promise.reject("options.url cannot empty")
    }

    let timeout = options.timeout || 1e4
    return Promise.race([
      this.waitForNavigation({
        timeout: timeout,
      }),
      new Promise((resolve, reject) => {
        let start = Date.now()
        let t = setInterval(() => {
          if (Date.now() - start >= timeout) {
            clearInterval(t)
            reject("waitForNavigationOut.timeout")
          }

          if (
            (isFunction(options.url) &amp;&amp; !options.url(this.url())) ||
            !this.url().startsWith(options.url)
          ) {
            clearInterval(t)
            resolve(true)
          }
        }, 100)
      }),
    ])
  }
  /**
   * 等待url跳入，不会等待跳入页面的加载事件
   * @param {Object} [options]
   * @property {string|Function} [options.url] 要跳入的url|检查当前url和跳入url是否匹配的函数
   * @property {number} [options.timeout] 超时时间，单位为ms，默认为10000ms
   *
   * @return {Promise&lt;boolean>}
   */
  waitForNavigationTo(options) {
    if (!options || !options.url) {
      return Promise.reject("options.url cannot empty")
    }

    let timeout = options.timeout || 1e4
    return new Promise((resolve, reject) => {
      let start = Date.now()
      let t = this.setInterval(() => {
        if (Date.now() - start >= timeout) {
          clearInterval(t)
          reject("waitForNavigationTo.timeout")
        }

        if (
          (isFunction(options.url) &amp;&amp; options.url(this.url())) ||
          this.url().startsWith(options.url)
        ) {
          clearInterval(t)
          resolve(true)
        }
      }, 100)
    })
  }
  /**
   * 在指定时间内轮询查询dom节点，直到查找到节点
   * @param {string} selector dom节点选择器
   * @param {Object} [options]
   * @property {boolean} [options.visible] 节点是否可见，如果visible为true时必须查到到dom节点且可见才会返回true
   * @property {number} [options.timeout] 超时时间，单位为ms，默认为10000ms
   * @property {number} [options.retry] 重试次数，默认不重试, 重试仅在发送超时的情况
   *
   * @return {Promise&lt;undefined>} 成功则resolve，失败返回reject
   */
  waitForSelector(selector, options) {
    return this.ipc.send(
      "frame.waitForSelector",
      {
        selector: selector,
        options: options,
      },
      options &amp;&amp; options.timeout,
      options &amp;&amp; options.retry
    )
  }
  /**
   * 在指定时间内轮询查询dom节点，查找到节点返回true，否则返回false
   * @param {string} selector dom节点选择器
   * @param {Object} options 和waitForSelector的options相同
   *
   * @return {Promise&lt;boolean>}
   */
  hasElement(selector, options) {
    return this.waitForSelector(selector, options).then(
      () => true,
      () => false
    )
  }
  /**
   * todo
   */
  waitForXPath(/* xpath, options */) {
    return Promise.reject("todo")
  }
  /**
   * 点击frame内的指定节点
   * @param {string} selector 选择器
   * @param {Object} options 暂不支持
   *
   * @return {Promise&lt;boolean>}
   */
  click(selector, options) {
    return this.document.$(selector).click(options)
  }
  /**
   * 聚焦frame内的指定节点
   * @param {string} selector 选择器
   * @param {Object} options 暂不支持
   *
   * @return {Promise&lt;boolean>}
   */
  focus(selector, options) {
    return this.document.$(selector).focus(options)
  }
  /**
   * 取消聚焦frame内的指定节点
   * @param {string} selector 选择器
   * @param {Object} options 暂不支持
   *
   * @return {Promise&lt;boolean>}
   */
  blur(selector, options) {
    return this.document.$(selector).blur(options)
  }
  /**
   * 鼠标移入frame内的指定节点，对应mouseover事件
   * @param {string} selector 选择器
   * @param {Object} options 暂不支持
   *
   * @return {Promise&lt;boolean>}
   */
  hover(selector, options) {
    return this.document.$(selector).hover(options)
  }
  /**
   * todo
   */
  tap(selector, options) {
    return this.document.$(selector).tap(options)
  }
  /**
   * 获取localStorage的所有key集合
   */
  localStorageKeys() {
    return this.ipc.send("frame.localStorageKeys", null, 1e4, 2)
  }
  /**
   * localStorage.getItem
   * @param {string} key
   *
   * @return {Promise&lt;string>}
   */
  localStorageGet(key) {
    return this.ipc.send(
      "frame.localStorageGet",
      {
        key: key,
      },
      1e4,
      2
    )
  }
  /**
   * localStorage.setItem
   * @param {string} key
   * @param {string} value
   *
   * @return {Promise&lt;undefined>}
   */
  localStorageSet(key, value) {
    return this.ipc.send(
      "frame.localStorageSet",
      {
        key: key,
        value: value,
      },
      1e4,
      2
    )
  }
  /**
   * localStorage.removeItem
   * @param {string} key
   *
   * @return {Promise&lt;undefined>}
   */
  localStorageRemove(key) {
    return this.ipc.send(
      "frame.localStorageRemove",
      {
        key: key,
      },
      1e4,
      2
    )
  }
}

export default proxyBindDecorator(
  [
    /**
     * [frame.document.$的简写]{@link ElementHandle#$}
     * @method Frame#$
     */
    "$",
    /**
     * [frame.document.$$的简写]{@link ElementHandle#$$}
     * @method Frame#$$
     */
    "$$",
    /**
     * [frame.document.$eval的简写]{@link ElementHandle#$eval}
     * @method Frame#$eval
     */
    "$eval",
    /**
     * [frame.document.$$eval的简写]{@link ElementHandle#$$eval}
     * @method Frame#$$eval
     */
    "$$eval",
    /**
     * [frame.document.$x的简写]{@link ElementHandle#$x}
     * @method Frame#$x
     */
    "$x",
  ],
  function () {
    return this.document
  }
)(Frame)
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Fri Nov 20 2020 12:04:49 GMT+0800 (GMT+08:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
